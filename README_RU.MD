# Пользовательские узлы для ComfyUI

Этот репозиторий содержит пользовательские узлы для ComfyUI, расширяющие функциональность для рабочих процессов.

## Доступные узлы

### Узлы обработки текста

#### 1. Конструктор переменных [darkilNodes]
![Конструктор переменных](docs/images/node_var_build.png)
- **Категория**: darkilNodes/text
- **Описание**: Создает текстовые переменные из нескольких входных данных с настраиваемым форматированием.
- **Функции**:
  - Поддержка нескольких типов ввода (текст, целые числа, числа с плавающей запятой)
  - Настройка разделителей и префиксов/суффиксов
  - Условный вывод в зависимости от наличия входных данных
- **Входы**:
  - `switch` (BOOL): Переключатель активности узла
  - `out_val_by_switch` (BOOL): Выводить, если активно
  - `var_name` (STRING): Имя переменной
  - `var_value` (STRING): Значение переменной
  - `INPUT_VAR` (STRING): Другие переменные (вход)

#### 2. Расширенный конструктор переменных [darkilNodes]
![Расширенный конструктор переменных](docs/images/node_adv_var_build.png)
- **Категория**: darkilNodes/text
- **Описание**: Расширенный конструктор текстовых переменных с продвинутыми опциями форматирования.
- **Функции**:
  - Поддержка нескольких типов ввода с пользовательским форматированием
  - Настройка разделителей и префиксов/суффиксов
  - Условный вывод в зависимости от наличия входных данных
  - Настройка форматирования целых и чисел с плавающей запятой
- **Входы**:
  - `switch` (BOOL): Переключатель активности узла
  - `out_val_by_switch` (BOOL): Выводить, если активно
  - `var_name` (STRING): Имя переменной
  - `var_text` (STRING): Значение переменной
  - `INPUT_VAR` (STRING): Другие переменные (вход)
  - `DYNAMIC_*` (STRING): Динамические входы
  - `condition` (BOOLEAN): Если True, выводится только при наличии входных данных
  - `int_format` (STRING): Строка формата для целых чисел
  - `float_format` (STRING): Строка формата для чисел с плавающей запятой

#### 3. Динамический конструктор промптов [darkilNodes]
![Динамический конструктор промптов 1](docs/images/node_prompt_build_1.png)
![Динамический конструктор промптов 2](docs/images/node_prompt_build_2.png)
- **Категория**: darkilNodes/text
- **Описание**: Динамически строит промпты из текстовых входов с различными опциями форматирования.
- **Функции**:
  - Поддержка нескольких типов ввода (текст, целые числа, числа с плавающей запятой)
  - Настройка разделителей и префиксов/суффиксов
  - Условный вывод в зависимости от наличия входных данных
  - Автоматическая обработка пустых/пробельных строк
- **Входы**:
  - `text` (STRING): Текстовый ввод для обработки
  - `PROMPT VISIBLED` (BOOL): Видимость текстового поля
  - `PROMPT ENABLED` (BOOL): Активность выхода `compiled_prompt`
  - `EXTRA ENABLED` (BOOL): Активность выхода `extra_compiled`

#### 4. Текст пустой [darkilNodes]
![Текст пустой](docs/images/node_text_is_empty.png)
- **Категория**: darkilNodes/text
- **Описание**: Проверяет, является ли текстовая строка пустой или содержит только пробельные символы.
- **Входы**:
  - `text` (STRING): Текст для проверки
- **Выходы**:
  - `BOOLEAN`: True, если текст пустой, False в противном случае

#### 5. Текст не пустой [darkilNodes]
![Текст не пустой](docs/images/node_text_not_empty.png)
- **Категория**: darkilNodes/text
- **Описание**: Проверяет, содержит ли текстовую строку содержимое.
- **Входы**:
  - `text` (STRING): Текст для проверки
- **Выходы**:
  - `BOOLEAN`: True, если текст не пустой, False в противном случае

#### 6. Подсчет строк текста [darkilNodes]
![Подсчет строк текста](docs/images/node_lines_count.png)
- **Категория**: darkilNodes/text
- **Описание**: Подсчитывает количество строк в текстовой строке.
- **Входы**:
  - `text` (STRING): Текст для подсчета строк
- **Выходы**:
  - `INT`: Количество строк в тексте

### Логические узлы

#### 1. Множественные переключатели [darkilNodes]
![Множественные переключатели 1](docs/images/node_multi_toggle_1.png)
![Множественные переключатели 2](docs/images/node_multi_toggle_2.png)
- **Категория**: darkilNodes/logic
- **Описание**: Предоставляет несколько переключателей для выбора опций.
- **Функции**:
  - Настройка через свойства узла
  - Поддержка радиокнопок
  - Настройка разделителя и последнего слова для объединения строк
- **Свойства конфигурации интерфейса**:
  - `text_for_toggles`: Определяет варианты переключателей (разделенные точкой с запятой или вертикальной чертой)
  - `is_radio_toggles`: Включает режим радиокнопок
  - `trim_values`: Удаляет пробелы из значений
  - `last_word`: Пользовательское слово перед последним элементом в объединенной строке
  - `delimiter`: Строка, используемая для объединения элементов

#### 2. Пользовательский выпадающий список [darkilNodes]
![Пользовательский выпадающий список 1](docs/images/node_combo_1.png)
![Пользовательский выпадающий список 2](docs/images/node_combo_2.png)
- **Категория**: darkilNodes/logic
- **Описание**: Позволяет выбирать из пользовательского списка.
- **Функции**:
  - Настройка через свойства узла
  - Поддержка разделения элементов точкой с запятой или вертикальной чертой
  - Вывод выбранного значения и справочной информации
- **Свойства конфигурации интерфейса**:
  - `text_for_combo`: Список элементов (разделенные точкой с запятой или вертикальной чертой)

### Узлы LoRA

#### 1. Список LoRA для WanVideoWrapper от Kijai [darkilNodes]
![Список LoRA для WanVideoWrapper от Kijai](docs/images/node_wan22.png)
- **Категория**: darkilNodes/lora
- **Описание**: Парсит текстовые списки определений LoRA для узлов WanVideoWrapper от Kijai.
- **Функции**:
  - Поддержка нескольких форматов ввода (новые строки, точки с запятой, вертикальные черты)
  - Обработка комментариев (как построчные, так и блочные)
  - Целевая настройка низко- и высокошумного модели с префиксами
  - Поддержка выбора блоков
  - Объединение LoRA для повышения эффективности
  - Возможность объединения предыдущего списка
- **Формат ввода**:
  - `<Имя LoRA>[:<сила>]`
  - Префиксы: `l<<`, `l<`, `<low:`, `low:` для низкошумной модели, `h<<`, `h<`, `<high:`, `high:` для высокошумной модели
- **Особые функции**:
  - Поддержка блочных комментариев `/* ... */` и строковых комментариев `// ...`
  - Опциональное объединение нескольких LoRA в один тензор
  - Опция загрузки с низким потреблением памяти
  - Автоматическая обработка отсутствующих файлов с логированием ошибок

### Узлы обработки файлов

#### 1. Список файлов из директории [darkilNodes]
![Список файлов из директории](docs/images/node_files_list.png)
- **Категория**: darkilNodes/files
- **Описание**: Список файлов в директории на основе расширения и критериев сортировки.
- **Функции**:
  - Поддержка шаблонов glob для фильтрации файлов
  - Множественные варианты сортировки (по дате, имени, размеру)
  - Возможность рекурсивного поиска в поддиректориях
  - Настройка формата вывода (с/без расширений, полные пути)
- **Входы**:
  - `folder_path` (STRING): Путь к директории для сканирования
  - `files_extension` (STRING): Фильтр расширения; может быть простым расширением (например, "png") или любым шаблоном glob (например, "*.txt")
  - `sort_by` (COMBO): Метод сортировки – по дате, имени, размеру и их варианты в обратном порядке
  - `sub_foldres` (BOOLEAN): Если true, искать рекурсивно в поддиректориях
  - `keep_extensions` (BOOLEAN): Сохранять расширения файлов в выходных именах
  - `keep_full_path` (BOOLEAN): Возвращать полные абсолютные пути вместо только имен файлов
- **Выходы**:
  - `found_list` (STRING): Список имен/путей файлов
  - `found_as_text` (STRING): Строка, разделенная переводами строки, со всеми файлами
  - `last_filename` (STRING): Имя/путь последнего файла после сортировки
  - `first_filename` (STRING): Имя/путь первого файла после сортировки
  - `files_count` (INT): Общее количество найденных файлов

## Установка

1. Склонируйте или скачайте этот репозиторий в папку `custom_nodes` ComfyUI:
   ```
   cd ComfyUI/custom_nodes
   git clone https://github.com/yourusername/comfyui-custom-nodes.git
   ```

2. Установите любые необходимые зависимости (если применимо):
   ```
   pip install -r requirements.txt
   ```

3. Перезапустите ComfyUI, чтобы загрузить новые узлы.

## Примеры использования

### Пример обработки текста
```
TextIsEmpty → Boolean Switch
TextNotEmpty → Boolean Switch  
TextLinesCount → Integer Display
```

### Пример управления LoRA
```
Wan22VideoLoraListBuilder → WanVideoWrapper (Kijai)
```

## Лицензия

Лицензия MIT - подробности см. в файле LICENSE.